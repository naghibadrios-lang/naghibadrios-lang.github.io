<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¨Ø§Ø²ÛŒ Ø±Ù†Ú¯â€ŒØ¢Ù…ÛŒØ²ÛŒ Ú©Ø³Ø±Ù‡Ø§</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 15px;
      text-align: center;
    }
    .designer {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      font-style: italic;
    }
    h1 {
      color: #2c3e50;
      font-size: 22px;
      margin: 10px 0;
    }
    #gameHeader {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    #helpBtn {
      padding: 6px 12px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
    }
    #scoreTimer {
      font-size: 16px;
      font-weight: bold;
      color: #2c3e50;
    }
    .controls {
      margin: 15px 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .type-btn {
      padding: 10px 15px;
      border: 2px solid #555;
      border-radius: 8px;
      background: white;
      font-size: 16px;
      cursor: pointer;
      min-width: 120px;
    }
    .type-btn:hover {
      opacity: 0.9;
    }
    .type-btn.selected {
      font-weight: bold;
    }
    .blue { background: #d1e7ff; }
    .green { background: #d4edda; }
    .red { background: #f8d7da; }
    .orange { background: #ffe5b4; }

    table {
      margin: 20px auto;
      border-collapse: separate;
      border-spacing: 6px;
    }
    td {
      width: 80px;
      height: 80px;
      border: 2px solid #444;
      text-align: center;
      vertical-align: middle;
      font-size: 18px;
      cursor: pointer;
      background: white;
      user-select: none;
      line-height: 1.2;
    }
    td.correct {
      border: 3px solid #28a745;
    }
    td.error {
      animation: shake 0.5s;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    #message {
      margin: 15px;
      min-height: 26px;
      font-size: 18px;
      font-weight: bold;
      color: #28a745;
    }
    #message.error {
      color: #dc3545;
    }

    /* Modal Ø±Ø§Ù‡Ù†Ù…Ø§ */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.7);
    }
    .modal-content {
      background: white;
      margin: 15% auto;
      padding: 20px;
      width: 85%;
      max-width: 450px;
      border-radius: 12px;
      direction: rtl;
    }
    .close {
      color: #888;
      float: left;
      font-size: 24px;
      cursor: pointer;
    }

    /* Ø³Ø¨Ú© Ú©Ø³Ø± Ø¹Ù…ÙˆØ¯ÛŒ */
    .fraction {
      display: inline-block;
      text-align: center;
      font-size: 18px;
    }
    .fraction sup, .fraction sub {
      display: block;
      font-size: 16px;
      font-family: Tahoma, sans-serif;
    }
    .fraction hr {
      margin: 1px 0;
      border: 0;
      border-top: 1px solid #000;
      width: 80%;
    }
  </style>
</head>
<body>
  <div class="designer">Design by Badr</div>
  <h1>Ø¨Ø§Ø²ÛŒ Ø±Ù†Ú¯â€ŒØ¢Ù…ÛŒØ²ÛŒ Ú©Ø³Ø±Ù‡Ø§</h1>

  <div id="gameHeader">
    <button id="helpBtn" onclick="showHelp()">Ø±Ø§Ù‡Ù†Ù…Ø§</button>
    <div id="scoreTimer">Ø§Ù…ØªÛŒØ§Ø²: 0 | Ø²Ù…Ø§Ù†: 0s</div>
  </div>

  <div class="controls">
    <button class="type-btn blue" onclick="selectType('less')">Ú©Ø³Ø± Ø³Ø¨Ú©<br><small>(Ú©ÙˆÚ†Ú©â€ŒØªØ± Ø§Ø² ÙˆØ§Ø­Ø¯)</small></button>
    <button class="type-btn green" onclick="selectType('equal')">Ú©Ø³Ø± Ú©Ø§Ù…Ù„<br><small>(Ø¨Ø±Ø§Ø¨Ø± ÙˆØ§Ø­Ø¯)</small></button>
    <button class="type-btn red" onclick="selectType('greater')">Ú©Ø³Ø± Ø³Ù†Ú¯ÛŒÙ†<br><small>(Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø§Ø² ÙˆØ§Ø­Ø¯)</small></button>
    <button class="type-btn orange" onclick="selectType('mixed')">Ø¹Ø¯Ø¯ ØªØ±Ú©ÛŒØ¨ÛŒ<br><small>(Ø¹Ø¯Ø¯ Ù…Ø®Ù„ÙˆØ·)</small></button>
  </div>

  <table id="fractionGrid">
    <!-- Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
  </table>

  <div id="message">ÛŒÚ© Ù†ÙˆØ¹ Ú©Ø³Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ØŒ Ø¨Ø¹Ø¯ Ø±ÙˆÛŒ Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†.</div>

  <!-- Modal Ø±Ø§Ù‡Ù†Ù…Ø§ -->
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeHelp()">&times;</span>
      <h3>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ</h3>
      <p>Ù‡Ø¯Ù: Ù‡Ø± Ù†ÙˆØ¹ Ú©Ø³Ø± Ø±Ø§ Ø¨Ø§ Ø±Ù†Ú¯ Ø¯Ø±Ø³ØªØ´ Ø±Ù†Ú¯ Ú©Ù†.</p>
      <ul style="text-align: right;">
        <li><span style="color:blue">ğŸ”µ Ú©Ø³Ø± Ø³Ø¨Ú©</span>: ØµÙˆØ±Øª Ú©ÙˆÚ†Ú©â€ŒØªØ± Ø§Ø² Ù…Ø®Ø±Ø¬</li>
        <li><span style="color:green">ğŸŸ¢ Ú©Ø³Ø± Ú©Ø§Ù…Ù„</span>: ØµÙˆØ±Øª Ø¨Ø±Ø§Ø¨Ø± Ù…Ø®Ø±Ø¬</li>
        <li><span style="color:red">ğŸ”´ Ú©Ø³Ø± Ø³Ù†Ú¯ÛŒÙ†</span>: ØµÙˆØ±Øª Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø§Ø² Ù…Ø®Ø±Ø¬</li>
        <li><span style="color:orange">ğŸŸ  Ø¹Ø¯Ø¯ ØªØ±Ú©ÛŒØ¨ÛŒ</span>: Ø¹Ø¯Ø¯ ØµØ­ÛŒØ­ + Ú©Ø³Ø±</li>
      </ul>
      <p>Ø±ÙˆÛŒ ÛŒÚ© Ø¯Ú©Ù…Ù‡Ù” Ø±Ù†Ú¯ Ú©Ù„ÛŒÚ© Ú©Ù†ØŒ Ø¨Ø¹Ø¯ Ø±ÙˆÛŒ Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø³Øª.</p>
    </div>
  </div>

  <script>
    // ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ Ú©Ø³Ø± Ø³Ø§Ø¯Ù‡ Ø¨Ù‡ ÙØ±Ù…Øª Ø¹Ù…ÙˆØ¯ÛŒ
    function formatFraction(fractionStr) {
      if (fractionStr.includes(' ')) {
        // Ø¹Ø¯Ø¯ Ù…Ø®Ù„ÙˆØ·: Ù…Ø«Ù„ "Û² Û±/Û³"
        const parts = fractionStr.split(' ');
        const whole = parts[0];
        const frac = parts[1];
        const [num, den] = frac.split('/');
        return `${whole}&nbsp;<span class="fraction"><sup>${num}</sup><hr><sub>${den}</sub></span>`;
      } else {
        // Ú©Ø³Ø± Ø³Ø§Ø¯Ù‡: Ù…Ø«Ù„ "Û³/Ûµ"
        const [num, den] = fractionStr.split('/');
        return `<span class="fraction"><sup>${num}</sup><hr><sub>${den}</sub></span>`;
      }
    }

    // Ù„ÛŒØ³Øª Ú©Ø³Ø±Ù‡Ø§ Ø¨Ø§ Ø§Ø¹Ø¯Ø§Ø¯ Ù„Ø§ØªÛŒÙ† (Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¢Ø³Ø§Ù†)
    const fractions = {
      less: ['1/2', '2/3', '3/4', '1/5', '2/5', '3/5', '4/5', '1/6', '5/6', '2/7', '3/7', '4/9'],
      equal: ['1/1', '2/2', '3/3', '4/4', '5/5', '6/6', '7/7', '8/8'],
      greater: ['3/2', '4/3', '5/2', '7/3', '9/4', '6/5', '10/3', '8/5', '7/2', '9/2'],
      mixed: ['1 1/2', '2 1/3', '1 2/3', '3 1/4', '2 3/5', '4 2/7', '1 3/4', '2 1/5']
    };

    // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ Ù„Ø§ØªÛŒÙ† Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
    function toPersianDigits(str) {
      return str.replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]);
    }

    let selectedType = null;
    let score = 0;
    let startTime = null;
    let timerInterval = null;
    let correctCount = 0;
    const totalCells = 16;

    function getRandomItems(arr, count) {
      const shuffled = [...arr].sort(() => 0.5 - Math.random());
      return shuffled.slice(0, count);
    }

    function generateGrid() {
      const grid = document.getElementById('fractionGrid');
      grid.innerHTML = '';

      const items = [
        ...getRandomItems(fractions.less, 4).map(v => ({value: v, type: 'less'})),
        ...getRandomItems(fractions.equal, 4).map(v => ({value: v, type: 'equal'})),
        ...getRandomItems(fractions.greater, 4).map(v => ({value: v, type: 'greater'})),
        ...getRandomItems(fractions.mixed, 4).map(v => ({value: v, type: 'mixed'}))
      ];

      items.sort(() => 0.5 - Math.random());

      for (let i = 0; i < 4; i++) {
        const row = document.createElement('tr');
        for (let j = 0; j < 4; j++) {
          const cell = document.createElement('td');
          const item = items[i * 4 + j];
          const persianValue = toPersianDigits(item.value);
          cell.innerHTML = formatFraction(persianValue);
          cell.dataset.type = item.type;
          cell.addEventListener('click', () => handleCellClick(cell));
          row.appendChild(cell);
        }
        grid.appendChild(row);
      }
    }

    function startTimer() {
      startTime = Date.now();
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        updateScoreDisplay(elapsed);
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function updateScoreDisplay(time = 0) {
      document.getElementById('scoreTimer').textContent = `Ø§Ù…ØªÛŒØ§Ø²: ${score} | Ø²Ù…Ø§Ù†: ${time}s`;
    }

    function selectType(type) {
      selectedType = type;
      document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('selected'));
      const colorClass = 
        type === 'less' ? 'blue' : 
        type === 'equal' ? 'green' : 
        type === 'greater' ? 'red' : 'orange';
      document.querySelector(`.type-btn.${colorClass}`).classList.add('selected');
      showMessage(`Ù†ÙˆØ¹ "${getTypeName(type)}" Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯.`);
    }

    function getTypeName(type) {
      return {
        less: 'Ú©Ø³Ø± Ø³Ø¨Ú©',
        equal: 'Ú©Ø³Ø± Ú©Ø§Ù…Ù„',
        greater: 'Ú©Ø³Ø± Ø³Ù†Ú¯ÛŒÙ†',
        mixed: 'Ø¹Ø¯Ø¯ ØªØ±Ú©ÛŒØ¨ÛŒ'
      }[type];
    }

    function handleCellClick(cell) {
      if (!selectedType) {
        showMessage('Ø§ÙˆÙ„ ÛŒÚ© Ù†ÙˆØ¹ Ú©Ø³Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†!', true);
        return;
      }

      const correctType = cell.dataset.type;
      if (selectedType === correctType) {
        cell.style.backgroundColor = 
          selectedType === 'less' ? '#d1e7ff' :
          selectedType === 'equal' ? '#d4edda' :
          selectedType === 'greater' ? '#f8d7da' : '#ffe5b4';
        cell.classList.add('correct');
        score += 10;
        correctCount++;
        updateScoreDisplay(Math.floor((Date.now() - startTime) / 1000));
        showMessage('Ø¢ÙØ±ÛŒÙ†! âœ…');
        if (correctCount === totalCells) {
          stopTimer();
          const finalTime = Math.floor((Date.now() - startTime) / 1000);
          setTimeout(() => {
            showMessage(`ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ø§Ù…ØªÛŒØ§Ø²: ${score} â€” Ø²Ù…Ø§Ù†: ${finalTime} Ø«Ø§Ù†ÛŒÙ‡ ğŸ‰`);
          }, 500);
        }
      } else {
        cell.classList.add('error');
        setTimeout(() => cell.classList.remove('error'), 500);
        score = Math.max(0, score - 5);
        updateScoreDisplay(Math.floor((Date.now() - startTime) / 1000));
        showMessage('âŒ Ø§Ø´ØªØ¨Ø§Ù‡! Ø§ÛŒÙ† Ú©Ø³Ø± Ù…Ø§Ù„ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ù†ÛŒØ³Øª.', true);
      }
    }

    function showMessage(text, isError = false) {
      const msg = document.getElementById('message');
      msg.textContent = text;
      msg.className = isError ? 'error' : '';
    }

    function showHelp() {
      document.getElementById('helpModal').style.display = 'block';
    }

    function closeHelp() {
      document.getElementById('helpModal').style.display = 'none';
    }

    window.onclick = function(event) {
      const modal = document.getElementById('helpModal');
      if (event.target === modal) closeHelp();
    }

    generateGrid();
    startTimer();
  </script>
</body>
</html>